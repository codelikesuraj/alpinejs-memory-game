<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AlpineJS Memory Game</title>
    <meta name="description" content="AlpineJS Memory Game" />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
  </head>
  <body>
    <div x-data="game" class="h-screen flex justify-center items-center">
      <button
        x-on:click="reset"
        class="fixed top-0 m-10 px-2 py-1 lg:px-4 lg:py-2 bg-orange-200 border-1 text-orange-800 border-orange-800 rounded font-semibold tracking-wide"
      >
        New Game
      </button>

      <div
        class="mx-auto grid grid-cols-3 lg:grid-cols-4 gap-3"
      >
        <template x-for="card in cards">
          <div class="flex w-20 md:w-30 lg:w-40 aspect-square">
            <button
              class="flex-1"
              x-show="!card.cleared"
              :style="'background: ' + (card.flipped ? card.color : 'gray')"
              x-on:click="flipCard(card)"
              :disabled="flippedCards.length >= 2 || card.cleared"
            ></button>
          </div>
        </template>
      </div>
    </div>

    <script type="text/javascript" defer>
      function pause(milliseconds) {
        return new Promise((resolve) => setTimeout(resolve, milliseconds));
      }

      function game() {
        return {
          baseCards: [
            { color: "red", flipped: false, cleared: false },
            { color: "orange", flipped: false, cleared: false },
            { color: "yellow", flipped: false, cleared: false },
            { color: "green", flipped: false, cleared: false },
            { color: "blue", flipped: false, cleared: false },
            { color: "indigo", flipped: false, cleared: false },
            { color: "red", flipped: false, cleared: false },
            { color: "orange", flipped: false, cleared: false },
            { color: "yellow", flipped: false, cleared: false },
            { color: "green", flipped: false, cleared: false },
            { color: "blue", flipped: false, cleared: false },
            { color: "indigo", flipped: false, cleared: false },
          ],

          cards: [],

          init() {
            this.randomiseCards();
          },

          get clearedCards() {
            return this.cards.filter((card) => card.cleared);
          },

          get flippedCards() {
            return this.cards.filter((card) => card.flipped);
          },

          get remainingCards() {
            return this.cards.filter((card) => !card.cleared);
          },

          get hasMatch() {
            return this.flippedCards[0].color === this.flippedCards[1].color;
          },

          get points() {
            return this.clearedCards.length;
          },

          randomiseCards() {
            this.cards = this.baseCards.sort(() => Math.random() - 0.5);
          },

          reset() {
            this.randomiseCards();

            this.cards.forEach((card) => {
              card.cleared = false;
              card.flipped = false;
            });
          },

          async flipCard(card) {
            card.flipped = !card.flipped;

            if (this.flippedCards.length !== 2) {
              return;
            }

            await pause(200);

            if (this.hasMatch) {
              this.flippedCards.forEach((card) => (card.cleared = true));

              if (!this.remainingCards.length) {
                alert("You won!");
                this.reset();
              }
            } else {
              await pause(200);
            }

            this.flippedCards.forEach((card) => (card.flipped = false));
          },
        };
      }
    </script>
  </body>
</html>
