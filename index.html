<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AlpineJS Memory Game</title>
    <meta name="description" content="AlpineJS Memory Game" />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
  </head>
  <body>
    <div
      x-data="game"
      class="h-screen flex flex-col justify-evenly items-center"
    >
      <div class="text-center space-y-2">
        <h1 class="font-bold text-4xl absolute top-0 right-0 left-0 py-2">
          Memory Game
        </h1>
        <div class="text-xl font-semibold">
          Time spent -
          <span x-text="formattedTime(duration.hours)"></span> :
          <span x-text="formattedTime(duration.minutes)"></span> :
          <span x-text="formattedTime(duration.seconds)"></span>
        </div>
      </div>

      <div class="mx-auto grid grid-cols-3 lg:grid-cols-4 gap-3">
        <template x-for="card in cards">
          <div class="flex w-20 md:w-30 lg:w-40 aspect-square">
            <button
              class="flex-1"
              x-show="!card.cleared"
              :style="'background: ' + (card.flipped ? card.color : 'gray')"
              x-on:click="flipCard(card)"
              :disabled="flippedCards.length >= 2 || card.cleared"
            ></button>
          </div>
        </template>
      </div>

      <div class="text-center">
        <button
          x-on:click="reset"
          class="m-10 px-2 py-1 lg:px-4 lg:py-2 bg-orange-200 border-1 text-orange-800 border-orange-800 rounded font-semibold tracking-wide"
        >
          New Game
        </button>
        <div class="tracking-wider">Made with love by <a class="underline font-semibold" href="https://abdulbakisuraj.com" target="_blank">Abdulbaki Suraj</a>.</div>
      </div>
    </div>

    <script type="text/javascript" defer>
      function pause(milliseconds) {
        return new Promise((resolve) => setTimeout(resolve, milliseconds));
      }

      function game() {
        return {
          baseCards: [
            { color: "red", flipped: false, cleared: false },
            { color: "orange", flipped: false, cleared: false },
            { color: "yellow", flipped: false, cleared: false },
            { color: "green", flipped: false, cleared: false },
            { color: "blue", flipped: false, cleared: false },
            { color: "indigo", flipped: false, cleared: false },
            { color: "red", flipped: false, cleared: false },
            { color: "orange", flipped: false, cleared: false },
            { color: "yellow", flipped: false, cleared: false },
            { color: "green", flipped: false, cleared: false },
            { color: "blue", flipped: false, cleared: false },
            { color: "indigo", flipped: false, cleared: false },
          ],

          cards: [],

          time: 0,

          init() {
            this.randomiseCards();
            setInterval(() => {
              this.time += 1;
            }, 1000);
          },

          get clearedCards() {
            return this.cards.filter((card) => card.cleared);
          },

          get flippedCards() {
            return this.cards.filter((card) => card.flipped);
          },

          get remainingCards() {
            return this.cards.filter((card) => !card.cleared);
          },

          get hasMatch() {
            return this.flippedCards[0].color === this.flippedCards[1].color;
          },

          get points() {
            return this.clearedCards.length;
          },

          get duration() {
            return {
              seconds: this.time % 60,
              minutes: (this.time / 60) % 60,
              hours: (this.time / 60 / 60) % 60,
            };
          },

          formattedTime(time) {
            return Math.floor(time).toString().padStart(2, "0");
          },

          randomiseCards() {
            this.cards = this.baseCards.sort(() => Math.random() - 0.5);
          },

          reset() {
            this.randomiseCards();

            this.cards.forEach((card) => {
              card.cleared = false;
              card.flipped = false;
            });

            this.time = 0;
          },

          async flipCard(card) {
            card.flipped = !card.flipped;

            if (this.flippedCards.length !== 2) {
              return;
            }

            await pause(200);

            if (this.hasMatch) {
              this.flippedCards.forEach((card) => (card.cleared = true));

              if (!this.remainingCards.length) {
                const hours = Math.floor(this.duration.hours);
                const minutes = Math.floor(this.duration.minutes);
                const seconds = Math.floor(this.duration.seconds);
                let message = "Awesome! You finished in ";

                if (hours > 0) {
                  message += `${hours} hours, `;
                }

                if (minutes > 0) {
                  message += `${minutes} minutes and `;
                }

                if (seconds > 0) {
                  message += `${seconds} seconds`;
                }

                message += ".";

                alert(message);

                this.reset();
              }
            } else {
              await pause(200);
            }

            this.flippedCards.forEach((card) => (card.flipped = false));
          },
        };
      }
    </script>
  </body>
</html>
